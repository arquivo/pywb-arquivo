<!DOCTYPE html>

<meta name=viewport content="width=device-width, initial-scale=1">

<html lang="pt" ng-app="ionic">
<head>  
<meta name=viewport content="width=device-width, initial-scale=1">
  <meta property="og:image" content="http://arquivo.pt/img/logoFace.png">
  <!-- Google Analytics-->
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-21825027-1', 'auto');
      ga('send', 'pageview');
    </script>
    <script>
      wbinfo = {}
      wbinfo.prefix = "{{ wb_prefix }}";
      ts = "{{ wb_url.timestamp }}"; //TODO:: maybe in the future remove this variable and use only the above
      patching = "{{ metadata.patching }}";
      

    </script>


    <!-- Jquery-->
    <script src="{{ static_prefix }}/dependencies/jquery-latest.min.js"></script>
    <!-- Plugin for cookie to choose language-->
    <script src="{{ static_prefix }}/dependencies/js.cookie.js"></script>
    <!-- Plugin for responsive modals-->
    <script src="{{ static_prefix }}/js/uglipop.min.js"></script>
    <!-- Javascript code for this page-->
  <script type="text/javascript" src="{{ static_prefix }}/js/frameInsert.js?release=ImageSearch"> </script>
    <!-- ionicons-->
    <script src="{{ static_prefix }}/dependencies/ionic.bundle.min.js"></script>
    <!--bootstrap -->
    <link href="{{ static_prefix }}/css/bootstrap.min.css?release=ImageSearch" rel ="stylesheet" >
    <script src="{{ static_prefix }}/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="{{ static_prefix }}/css/font-awesome.min.css">

    <script>
        var language = localStorage.language;
        if( language == 'EN'){
          $('html').attr('lang', 'en');
    document.write('<script type="text/javascript" language="JavaScript" src="{{ static_prefix }}/properties/ConstantsEN.js?release=ImageSearch"><\/script>');
        }
        else{
          $('html').attr('lang', 'pt');
    document.write('<script type="text/javascript" language="JavaScript" src="{{ static_prefix }}/properties/ConstantsPT.js?release=ImageSearch"><\/script>');
        }
    </script>
    <!-- Twitter js -->
    <script>
          window.twttr = (function(d, s, id) {
          var js, fjs = d.getElementsByTagName(s)[0],
            t = window.twttr || {};
          if (d.getElementById(id)) return t;
          js = d.createElement(s);
          js.id = id;
          js.src = "https://platform.twitter.com/widgets.js";
          fjs.parentNode.insertBefore(js, fjs);
         
          t._e = [];
          t.ready = function(f) {
            t._e.push(f);
          };
         
          return t;
        }(document, "script", "twitter-wjs"));
    </script>
    <script src="{{ static_prefix }}/wb_frame.js"></script>
    <script>
        var cframe = new ContentFrame({"url": "{{ url }}" + window.location.hash,
                               "prefix": "{{ wb_prefix }}",
                               "request_ts": "{{ wb_url.timestamp }}",
                               "iframe": "#replay_iframe"});
    </script>
        
    <!-- Overwriting pywb set_state function in order to properly update our toolbar when iframe changes-->
<script>
  
function set_state(new_url, new_timestamp) {
    // current url
    url = new_url;
    wbinfo.capture_url = new_url;
    var truncatedUrl = truncateUrl(url);
    $("#update1").text(truncatedUrl);
    $("#update2").text(truncatedUrl);
 
    $('#update1').attr('title', url);
    $("#update2").attr('title', url);  

    $("#update1").attr('href',url);
    $("#update2").attr('href',url); 

    if(new_timestamp != undefined){
      ts = new_timestamp; //global variable timestamp
    }

    ga('set', 'page', '/wayback/'+ ts + '/'+ url);
    ga('send', 'pageview');    

    //update the date on minimized bar
    $('#timeMinimized').html(getDatets(ts)+'<span> '+Content.at+' </span>'+getHoursMinutes()+'<span> GMT </span>');                      
    var urlEncoded = encodeURIComponent('{{ search_location }}/noFrame/replay/'+ts+'/'+url);
    $('#dlImgLink').attr('onClick', 'window.open(\'{{ search_location }}/screenshot/?url='+urlEncoded+'\')');

    /*$('#a_print').attr('href','javascript:getImageToPrint("'+urlEncoded+'")');*/
   
    theurl= '{{wb_prefix}}'+ts+'/'+url;
    addthis.update('share', 'url', theurl);

    // find og:image metatag inside the iframe, if no image found maintain arquivo.pt's logo
    var ogImageURL =  $("#replay_iframe").contents().find("meta[property='og:image']").attr("content");

    if( ogImageURL!= undefined && ogImageURL!=null){
      $("meta[property='og:image']").attr("content", ogImageURL);
    }

    var title = $("#replay_iframe").contents().find("meta[property='og:title']").attr("content");
    if(title === undefined || title === null) // there is no og:title meta tag in this iframe
    {
        title = $("#replay_iframe").contents().find("title").html(); //search for a title tag in the iframe
        if (title === undefined || !title.length){ //there is no title
            //top.alert("No title");
            title = Content.shareMessage;
        }
    }
    title = title + Content.preservedByArquivo;
    document.title = title;

    addthis.update('share', 'title', title);
    addthis.toolbox('.addthis_toolbox', addthis_config, addthis_share);
    $('meta[property="og:url"]').attr('content', theurl);




    //List the versions of current url in the side bar
    if(sideMenuVersion != true){ // TODO:: improve this Dirty hack global var to define a leftMenu version and preserve leftMenu state
        //top.alert("Updating the Versions on the Side Menu :)");
        setTimeout(updateVersionsOfUrl(url), 800000);
       // updateVersionsOfUrl(url);
    }
    sideMenuVersion =false;

}
</script>
<!--end pywb changes -->

    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Arquivo.pt</title>
    <link rel="shortcut icon" href="{{ static_prefix }}/img/logo-16.png" type="image/x-icon">

    <!-- Custom CSS -->
    <link href="{{ static_prefix }}/css/screen.css?release=ImageSearch" rel ="stylesheet" >

    <!--<link href="css/screen.css" rel="stylesheet">-->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
    <script>
    window.addEventListener("message", function(event) {
  if (event.data.wb_type == "load" || event.data.wb_type == "replace-url") {
    console.log("New Url: " + event.data.url);
    console.log("New Timestamp: " + event.data.ts);
    set_state(event.data.url, event.data.ts);
  }
});
    </script>

</head>
<body >  
    <script type="text/javascript">
    var addthis_config = addthis_config||{};
        addthis_config.data_track_addressbar = false;
        addthis_config.data_track_clickback = false;
    </script>
    <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5645cdb2e22ca317" async="async">
    </script>

    <!--<div class="maskLoading noprint" style=""></div>-->
    <div class="maskMenu"></div> 
    <div id="loadingAnimation" class="noprint">
      <i class="fa fa-circle-o-notch fa-spin noprint"></i>
    </div>                           
    <div id="page">
            <div id="pageWrapper" style="height: 100%; position:absolute;">  
              <div id="topbar" class="noprint">
                <div id="hbarMinimized">
      <div id="logoDivMinimized"><img id="logoMinimized" src="{{ static_prefix }}/img/AWP_200_100.png" width="40px" alt="Arquivo.pt"></img></div>
                        <div id="urlDivMinimized"><a id="update2" href="" target="_blank">                
                            <script type="text/javascript">
                                document.write(truncateUrl("{{url}}"));
                                $("#update2").attr('title', "{{url}}");
                            </script></a>
                        </div>
                        <div id="timeDivMinimized">
                          <script>
                            document.write('<p id="timeMinimized">'+getDatets(ts)+'<span> '+Content.at+' </span>'+getHoursMinutes()+'<span> GMT </span>'+'</p>');
                          </script>
                        </div>
                </div>
                  <!--the below anchor is the button to minimize/maximize the replayBars it is a fixed element -->
                  <script type="text/javascript">
                    document.write('<a href="#" onclick="minimizeMaximize()" id ="minimizeOrMaximize" title="'+Content.minimizeMaximizeTitle+'"><img src="{{ static_prefix }}/img/icon_minimize.png" style="    position: fixed; top: 0.3em; right: 0.5em; height: 40px;" alt="'+Content.minimizeMaximizeIcon+'" /></a> ')
                  </script>
          
                  <div id="hbar">
                    <div class="logoDiv" id="logodiv">
                      <a>
                        <script type="text/javascript">
                          document.write('<a href="/?l='+Content.language+'">');
                        </script>
                                             
                        <img id="arquivoImg" alt ="Arquivo.pt logo" title="Arquivo.pt homepage" src="{{ static_prefix }}/img/arquivo100v.png" /> 
                        <script type="text/javascript"> document.write("</a>")</script> 
                    </div>  
                    <div class="url" id = "urlTopbarDiv" class="noprint">
                        <a id="update1" href="" target="_blank">                
                            <script type="text/javascript">
                                document.write(truncateUrl("{{url}}"));
                                $("#update1").attr('title', "{{url}}");
                            </script>
                        </a>
                    </div>

                    <div class="toolbar noprint" id="toolBar">
                      <ul class="utilities" id="utilitiesUl">
                          <script type="text/javascript">
                          if( patching.toLowerCase() === 'true' ) {
                            document.write("<li id='reconstruct'><a title='"+Content.completePageLang+"' id='a_reconstruct' href='{{ host_prefix }}/noFrame/patching/record/{{ wb_url.timestamp }}/{{ url }}' \"><img id=\"reconstructImg\" alt=\""+Content.reconstructImg+"\" src=\"{{ static_prefix }}/img/reconstruct.png\"/><span class=\"menu-topbar\">"+Content.completePage+"</span><\/a><\/li>");
                          } else {
                              document.write("<li id='reconstruct'><a title='"+Content.completePageLang+"' id='a_reconstruct' href='' \"><img id=\"reconstructImg\" alt=\""+Content.reconstructImg+"\" src=\"{{ static_prefix }}/img/reconstruct.png\"/><span class=\"menu-topbar\">"+Content.completePage+"</span><\/a><\/li>");
                              attachCompletePageModal();
                          }
                          
                          </script>
                          <script type="text/javascript">
                              document.write("<li id='screenshot'><a title='"+Content.screenTitle+"' id='a_screenshot' href='' onClick=\"ga('send', 'event', 'ReplayBarFunctions', 'Screenshot', '{{ search_location }}/noFrame/replay/{{ wb_url.timestamp }}/{{url}}');\"><i alt=\""+Content.screenshotIcon+"\" class=\"ion ion-camera\"></i><span class=\"menu-topbar\">"+Content.savePage+"</span><\/a><\/li>");
                                attachScreenshotModal();
                          </script>
                          <script type="text/javascript">
                              document.write("<li id='techDetails'><a title='"+Content.moreInfoIcon+"' id='a_moreinfo' href=''><i alt=\""+Content.moreInfoIcon+"\" id=\"moreInfoIcon\"  class=\"ion ion-information-circled\"></i><span class=\"menu-topbar\">"+Content.technicalDetails+"</span><\/a><\/li>");
                                attachMoreInfoModal();
                          </script>
                          <script>
                                  /*var urlEncoded = encodeURIComponent('{{ search_location }}/noFrame/replay/{{ wb_url.timestamp }}/{{url}}'); */
                                  document.write("<li id='printLi'><a title='"+Content.printTitle+"' id='printOption' href=''><i id='printIon' alt=\""+Content.printIcon+"\" class='ion ion-android-print menu-icon'></i><span class=\"menu-topbar\">"+Content.printTitle+"</span></a></li>");
                                    attachPrintModal();
                          </script>                       
                          <script type="text/javascript">
                                  document.write("<li id='mobileLi'><a id='switchMobile' title='"+Content.switchMobileLang+"' href=''><i alt=\""+"teste"+"\" class='ion ion ion-iphone menu-icon'></i><span class=\"menu-topbar\">"+Content.switchMobile+"</span></a></li>");
                                  attachSwitchMobile();                            
                          </script>

                          <li class="lang">
                            <script>
                              if(language === 'PT') {
                                 document.write('<a id="changeLanguagePT" class="languagePTactive" href="" title="'+Content.changeLanguageTitlePT+'">');           
                               } else {
                                  document.write('<a id="changeLanguagePT" class="languagePT" href="" title="'+Content.changeLanguageTitlePT+'">');  
                               }
                                document.write(Content.portugueseLanguage); 
                                $('#changeLanguagePT').click(function(){ 
                                  localStorage.setItem('language', Content.portugueseLanguage);
                                  window.location.reload();
                                  return false; 
                                });
                              </script>
                            </a>&nbsp;<span class="languagePTactive">|&nbsp;</span> 
                            <script>
                              if(language === 'EN') {
                                document.write('<a id="changeLanguageEN" class="languageENactive" href="" title="'+Content.changeLanguageTitleEN+'">');  
                              } else {
                                document.write('<a id="changeLanguageEN" class="languageEN" href="" title="'+Content.changeLanguageTitleEN+'">');  
                              }
                              document.write(Content.englishLanguage); 
                                $('#changeLanguageEN').click(function(){ 
                                  localStorage.setItem('language', Content.englishLanguage);
                                  window.location.reload();
                                  return false; 
                                });
                              </script>
                            </a>
                          </li>                      
                      </ul>
                  </div>
                </div>  

        <!-- Page Content -->
        <div id="page-content-wrapper" class="noprint">
            <script>
              setTimeout(updateVersionsOfUrl('{{url}}'), 800000);
            </script>
                <script type="text/javascript">
                  document.write('<div id="iframeBox" class="container-fluid" class = "noprint" style="height: '+(window.innerHeight - $('#toolBar').height()) +'px;"><iframe style="background-color: #fff;border-left: 1px solid #fff; border-right:none; border-top:none;border-bottom:none; height:100%; width: 100%;" name="replay_iframe" id="replay_iframe" src="{{ wb_prefix + embed_url }}" seamless="seamless" frameborder="0" scrolling="yes" class="wb_iframe noprint" target="_parent" >')
                </script>
                
                <script>
                    window.onunload = function() {
                        // Notify top window of the unload event
                        window.top.postMessage('iframe_change', '*');
                    };
                </script>

                </iframe>
            </div>
        </div>

    <div id="wrapper" class="noprint">
        <!-- Sidebar -->
        <div id="sidebar-wrapper" class="noprint">
          <script>
            $('#sidebar-wrapper').css("height", (window.innerHeight - $('#toolBar').height())  +"px");
          </script>

              <ul class="sidebar-functions">

                            <li id="tableofVersionsSpinnerLi"><ion-spinner icon="android" class="spinner spinner-android" id="tableofVersionsSpinner"></ion-spinner></li>
                            <li id="sidebarli">
                              <script type="text/javascript">document.write('<a id="versionsTable" href="" class="versions-table" title="'+Content.versionsStoredTable+'" style="text-decoration:none;color:#fff">')</script>
                                    <script>
                                        document.getElementById("versionsTable").setAttribute("href","/search.jsp?l="+Content.language+"&query="+ "{{ url }}" + "&btnSubmit=Pesquisar");
                                        $('#versionsTable').attr('onClick','ga(\'send\', \'event\', \'ReplayBarFunctions\', \'Table of Versions\', \'{{ search_location }}/search.jsp'+Content.language+'&query="{{ url }}&btnSubmit=Pesquisar"\');');
                                    </script>
                                    
                                      <script type="text/javascript">
                                        document.write('<div><i alt="'+Content.iongrid+'"  class="fa fa-list" style=""></i><span id="tableOfVersionsSpan" style="vertical-align: bottom"> '+Content.table+'</span></div>');
                                      </script>
                                </a>                    
                            </li>
                </ul>                     
            <ul class="sidebar-nav" id ="yearList" style="list-style: none;">
            </ul>
        </div>
        <script type="text/javascript">/*$('#scroll-area').getNiceScroll().resize();*/</script>
        <!-- /#sidebar-wrapper -->

    </div>

  </div>
    <!-- /#wrapper -->
            </div>
          </div>  
          
<script type="text/javascript">
    document.write('<div class="printIframe" id="divPrintMe" style="display: block;"></div>' );
</script>

</body>
</html>
